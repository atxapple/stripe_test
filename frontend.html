<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stripe Checkout Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 40px;
        }
        h1 {
            color: #222;
        }
        button {
            padding: 12px 20px;
            margin-right: 15px;
            border: none;
            border-radius: 6px;
            background: #2d7a7a;
            color: white;
            font-size: 16px;
            cursor: pointer;
        }
        button:hover {
            background: #215c5c;
        }
        #error {
            margin-top: 25px;
            color: red;
            font-weight: bold;
        }
    </style>
</head>
<body>

    <h1>Stripe Checkout Test</h1>
    <p>Select a product and proceed to test payment:</p>

    <button onclick="checkout6()">Buy 6-Month Bundle</button>
    <button onclick="checkout1()">Buy 1-Month Bundle</button>

    <div id="error"></div>

    <script>
        // â›” UPDATE THIS IF Railway URL CHANGES
        const BACKEND_URL = "https://stripetest-production-5339.up.railway.app";

        const PRICE_6_MONTH = "price_1STtgiPQIh9OIXi6LMHxIIIp";  // replace if needed
        const PRICE_1_MONTH = "price_1STth3PQIh9OIXi6qIP4tSBn"; // replace with actual price ID

        async function createCheckout(priceId) {
            try {
                const response = await fetch(`${BACKEND_URL}/create-checkout-session`, {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ price_id: priceId })
                });

                let data;
                
                // Try parsing JSON. If it fails, backend returned HTML (error page).
                try {
                    data = await response.json();
                } catch (err) {
                    document.getElementById("error").innerText =
                        "Backend returned non-JSON response. Probably a 500 server error.";
                    return;
                }

                if (data.url) {
                    window.location.href = data.url;
                } else {
                    document.getElementById("error").innerText =
                        "Backend error: " + JSON.stringify(data, null, 2);
                }

            } catch (error) {
                document.getElementById("error").innerText = 
                    "Network error: " + error.message;
            }
        }

        function checkout6() {
            createCheckout(PRICE_6_MONTH);
        }

        function checkout1() {
            createCheckout(PRICE_1_MONTH);
        }
    </script>

</body>
</html>
